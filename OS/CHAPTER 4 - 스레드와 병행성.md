# CHAPTER 4 - 스레드와 병행성

## 1. 개요

스레드는 CPU 이용의 기본 단위다.

<img width="484" alt="Untitled" src="https://user-images.githubusercontent.com/75190035/174301862-be79c288-764d-448f-ae29-b72745444ffb.png">

- 구성: 스레드는 스레드 ID, 프로그램 카운터(PC), 레지스터 집합 그리고 스택으로 구성된다.
- 공유: 스레드는 같은 프로세스에 속한 다른 스레드와 메모리 공간(코드, 데이터 섹션)과 자원(열린 파일이나 신호와 같은 운영체제 자원)들을 공유한다.
- 비공유: 개별적인 프로그램 카운터, SP, 레지스터, 스택(특히  스택에 파라미터, 리턴 Address를 저장하기 때문에 공유하면 안된다.)

### 1.1 동기_Motivation

현대의 대부분의 컴퓨터, 모바일 기기에서 작동하는 소프트웨어 응용 프로그램들은 다중 스레드를 이용한다. 

하나의 응용 프로그램이 여러개의 비슷한 작업을 처리해야 할 상황에서, 단일 스레드 프로세스로 동작한다면, 클라이언트는 자신의 요구가 서비스되기까지 매우 긴 시간을 기다려야 한다.

이를 위한 해결책으로, 서버에게 서비스 요청이 들어오면 프로세스는 그 요청을 수행할 별도의 프로세스를 생성할 수 있지만 비용과 시간이 많이든다.

따라서 대부분은 프로세스 안에 여러 스레드를 만들어 해당 문제를 해결한다.

### 1.2 장점_Benefits

- 응답성(reponsiveness): 응용 프로그램의 일부분이 봉쇄되거나, 응용 프로그램이 긴 작업을 수행 하더라도 프로그램의 수행이 계속되는 것을 허용함으로써, 사용자에 대한 응답성을 증가시킨다.
- 자원 공유(resource sharing): 프로세스는 공유 메모리와 메시지 전달 기법을 통해 자원을 공유할 수 있다. 그러나 스레드는 자동으로 그들이 속한 프로세스의 자원들과 메모리를 공유한다.
- 경제성(economy): 프로세스 생성을 위해 메모리, 자원을 할당하는 것은 비용이 많이 드는 작업이다. 스레드는 자신이 속한 프로세스의 자원들을 공유하기 때문에 스레드를 생성하고 문맥 교환하는 것이 더욱 경제적이다.
- 규모 적응성(scalability): 다중 처리기 구조에서 각각의 스레드가 다른 처리기에서 병렬로 수행될 수 있기 때문에 해당 구조에서 이점을 갖는다.

---

## 2. 다중 코어 프로그래밍_Multicore Programming

컴퓨터 설계의 역사에서 단일 CPU 시스템은 다중 CPU 시스템(단일 컴퓨팅 칩에 여러 컴퓨팅 코어를 배치)으로 발전했다.

각 코어는 윤영체제에 별도의 CPU로 보이게 되는데 이것을 다중 코어라고 하며, 다중 스레드 프로그래밍은 이러한 여러 컴퓨팅 코어를 보다 효율적으로 사용하고 병행성을 향상시키는 기법을 제공한다.

<img width="436" alt="Untitled 1" src="https://user-images.githubusercontent.com/75190035/174301877-0d93b8f8-6306-4e89-b888-3fb06d1c7b9f.png">

<img width="436" alt="Untitled 2" src="https://user-images.githubusercontent.com/75190035/174301892-954e32f7-60c5-4377-af2c-785de895aadd.png">

### 2.1 프로그래밍 도전과제_Programming Challenges

일반적으로 다중 코어 시스템을 위해 프로그래밍하기 위해서는 극복해야 할 과제가 있다.

- 태스크 인식(identifying tasks)
    - Application을 분석해 독립된 병행 가능 태스크로 나눌 수 있는 영역을 찾는 작업이 필요
    - 이상적으로는 태스크는 서로 독립적이고 따라서 개별 코어에서 병렬 실행될 수 있어야 한다.
- 균형(balance):
    - 찾아진 부분들이 전체 작업에 균등한 기여도를 가지도록 태스크로 나누는 것이 중요하다.
- 데이터 분리(data spliting)
    - 태스크가 접근하고 조작하는 데이터 또한 개별 코어에서 사용할 수 있도록 나누어져야 한다.
- 데이터 종속성(data dependency)
    - 태스크가 접근하는 데이터는 둘 이상의 태스크 사이에 종속성이 없는지 검토되어야 한다.
    - 종속적인 경우 프로그래머가 데이터 종속성을 수용할 수 있도록 태스크의 수행을 잘 동기화해야 한다.
- 시험 및 디버깅(testing and debugging)
    - 병행 프로그램을 시험하고 디버깅하는 것은 단일 스레드 응용을 시험하고 디버깅하는 것보다 근본적으로 훨씬 어렵다.

---

> 참고
> 
> - 책
> 
> [⌜Operating System Concepts 10th - Abraham Silberschatz, Peter B. Galvin, Greg Gagne⌟](http://www.yes24.com/Product/Goods/78225791)
> 
> - 블로그
> 
> [https://blog.naver.com/bisu1532/221615645622](https://blog.naver.com/bisu1532/221615645622)
> 
> [https://suhwanc.tistory.com/178?category=879656](https://suhwanc.tistory.com/178?category=879656)
>
