# ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì™€ ìŠ¤í”„ë§ ë¹ˆ

## ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆ ìƒì„±

```java
ApplicationContext ac = new AnnotationConfigApplicationContext(AppConfig.class);
```

- ApplicationContextë¥¼ ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆë¼ê³  ë¶€ë¥´ê³ , ì´ê²ƒì€ ì¸í„°í˜ì´ìŠ¤ë‹¤.
- ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆëŠ” XMLì„ ê¸°ë°˜ìœ¼ë¡œ ë§Œë“¤ ìˆ˜ ìˆê³ , ì• ë…¸í…Œì´ì…˜ ê¸°ë°˜ì˜ ìë°” ì„¤ì • í´ë˜ìŠ¤ë¡œ ë§Œë“¤ ìˆ˜ ìˆë‹¤.

> ë” ì •í™•íˆëŠ” ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆë¥¼ ë¶€ë¥¼ ë•Œ â€˜BeanFactoryâ€™, â€˜ApplicationContextâ€™ ë¡œ êµ¬ë¶„í•´ì„œ ì´ì•¼ê¸°í•œë‹¤. â€˜BeanFactoryâ€™ ë¥¼ ì§ì ‘ ì‚¬ìš©í•˜ëŠ” ê²½ìš°ê°€ ë“œë¬¼ê¸° ë•Œë¬¸ì— ì¼ë°˜ì ìœ¼ë¡œ â€˜`ApplicationContext`â€™ ë¥¼ ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆë¼ê³  í•œë‹¤.
> 

1. ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆ ìƒì„±

![Untitled](https://user-images.githubusercontent.com/75190035/150499716-88fab3ba-8334-4d95-96c2-1a52ee6d2969.png)

1. ìŠ¤í”„ë§ ë¹ˆ ë“±ë¡

![Untitled 1](https://user-images.githubusercontent.com/75190035/150499727-4ac523c6-e214-416a-aea7-a8fef706fe09.png)

> ë¹ˆ ì´ë¦„ì€ ë³´í†µ ë©”ì„œë“œ ì´ë¦„ì„ ì‚¬ìš©í•˜ë©°, `@Bean(name="name")`í˜•ì‹ìœ¼ë¡œ ì´ë¦„ì„ ë³€ê²½í•  ìˆ˜ë„ ìˆë‹¤.  ë¹ˆ ì´ë¦„ì€ í•­ìƒ ë‹¤ë¥¼ ì´ë¦„ì„ ë¶€ì—¬í•´ì•¼ëœë‹¤. ê·¸ë ‡ì§€ ì•Šìœ¼ë©´ ë‹¤ë¥¸ ë¹ˆì„ ë¬´ì‹œí•˜ê±°ë‚˜, ê¸°ì¡´ ë¹ˆì„ ë®ì–´ë²„ë¦¬ê³ , ì„¤ì •ì— ë”°ë¼ ì˜¤ë¥˜ê°€ ë°œìƒí•  ìˆ˜ ìˆë‹¤.
> 

1. ìŠ¤í”„ë§ ë¹ˆ ì˜ì¡´ê´€ê³„ ì„¤ì • - ì¤€ë¹„

![Untitled 2](https://user-images.githubusercontent.com/75190035/150499761-f9a682e6-0fcf-40ee-b99d-7c2f53953fb7.png)

- ì‚¬ì‹¤ìƒ 2ë²ˆê³¼ ê°™ì€ ê³¼ì •(ê·¸ë¦¼ë‹¤ë¥´ê²Œ í•˜ê¸°ìœ„í•´ì„œ ë‹¨ê³„ë¥¼ ë‚˜ëˆ”)

1. ìŠ¤í”„ë§ ë¹ˆ ì˜ì¡´ê´€ê³„ ì„¤ì • - ì™„ë£Œ

![Untitled 3](https://user-images.githubusercontent.com/75190035/150499774-cba9c208-bda1-49a2-ae63-1d7fb65fcee7.png)

- ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆëŠ” ì„¤ì • ì •ë³´ë¥¼ ì°¸ê³ í•´ì„œ ì˜ì¡´ê´€ê³„ë¥¼ ì£¼ì…(DI)í•œë‹¤.

<aside>
ğŸ“Œ **ìŠ¤í”„ë§**ì€ ë¹ˆì„ ìƒì„±í•˜ê³ , ì˜ì¡´ê´€ê³„ë¥¼ ì£¼ì…í•˜ëŠ” ë‹¨ê³„ê°€ ë‚˜ëˆ„ì–´ì ¸ ìˆë‹¤.                                                 ì´ë ‡ê²Œ **ìë°” ì½”ë“œ**ë¡œ ìŠ¤í”„ë§ ë¹ˆì„ ë“±ë¡í•˜ë©´ ìƒì„±ìë¥¼ í˜¸ì¶œí•˜ë©´ì„œ ì˜ì¡´ê´€ê³„ ì£¼ì…ë„ í•œë²ˆì— ì²˜ë¦¬ëœë‹¤.

</aside>

## ë“±ë¡ëœ ë¹ˆ ì¡°íšŒ

```java
public class ApplicationContextInfoTest {

    AnnotationConfigApplicationContext ac = new AnnotationConfigApplicationContext(AppConfig.class);

    @Test
    @DisplayName("ëª¨ë“  ë¹ˆ ì¶œë ¥í•˜ê¸°")
    void findAllBean() {
        String[] beanDefinitionNames = ac.getBeanDefinitionNames();
        for (String beanDefinition : beanDefinitionNames) {
            Object bean = ac.getBean(beanDefinition);
            System.out.println("bean = " + beanDefinition + ", object = " + bean);
        }
    }
    @Test
    @DisplayName("ì• í”Œë¦¬ì¼€ì´ì…˜ ë¹ˆ ì¶œë ¥í•˜ê¸°")
    void findApplicationBean() {
        String[] beanDefinitionNames = ac.getBeanDefinitionNames();
        for (String beanDefinitionName : beanDefinitionNames) {
            BeanDefinition beanDefinition = ac.getBeanDefinition(beanDefinitionName);

            if (beanDefinition.getRole() == BeanDefinition.ROLE_APPLICATION) {
                Object bean = ac.getBean(beanDefinitionName);
                System.out.println("bean = " + beanDefinitionName + ", object = " + bean);
            }
        }
    }
}
```

- `ac.getBeanNames()` : ìŠ¤í”„ë§ì— ë“±ë¡ëœ ëª¨ë“  ë¹ˆ ì´ë¦„ ì¡°íšŒ
- `ac.getBean(â€nameâ€)` : í•´ë‹¹ ì´ë¦„ì„ ê°€ì§€ëŠ” ë¹ˆì˜ ê°ì²´ ì¡°íšŒ
- ìì²´ì ìœ¼ë¡œ ë“±ë¡í•œ Bean ë§Œ ë³´ê³ ì‹¶ì€ ê²½ìš°ëŠ”
    - â†’ `if (beanDefinition.getRole() == BeanDefinition.ROLE_APPLICATION)`
- ìŠ¤í”„ë§ì´ ë‚´ë¶€ì—ì„œ ì‚¬ìš©í•˜ëŠ” Bean ì„ ì¡°íšŒí•˜ëŠ” ê²½ìš°
    - â†’ `if (beanDefinition.getRole() == BeanDefinition.ROLE_INFRASTRUCTURE)`

## ac.getBean ì‚¬ìš© ì˜ˆì œ

```java
@Test
    @DisplayName("ë¹ˆ ì´ë¦„ìœ¼ë¡œ ì¡°íšŒ")
    void findBeanByName() {
        MemberService memberService = ac.getBean("memberService", MemberService.class);
        assertThat(memberService).isInstanceOf(MemberServiceImpl.class);
    }

    @Test
    @DisplayName("íƒ€ì…ìœ¼ë¡œ ì¡°íšŒ")
    void findBeanByType() {
        MemberService memberService = ac.getBean(MemberService.class);
        assertThat(memberService).isInstanceOf(MemberServiceImpl.class);
    }

    @Test
    @DisplayName("êµ¬ì²´ íƒ€ì…ìœ¼ë¡œ ì¡°íšŒ(ì´ë¦„ + íƒ€ì…)")
    void findBeanByType2() {
        MemberService memberService = ac.getBean("memberService", MemberServiceImpl.class);
        assertThat(memberService).isInstanceOf(MemberServiceImpl.class);
    }

    @Test
    @DisplayName("ì´ë¦„ìœ¼ë¡œ ì¡°íšŒ ì‹¤íŒ¨ -> NoSuchBeanDefinitionException")
    void findBeanByNameX() {
//        MemberService xxxx = ac.getBean("xxxx", MemberService.class);
        assertThrows(NoSuchBeanDefinitionException.class,
                () -> ac.getBean("xxxx", MemberService.class));
    }
```

## ë™ì¼í•œ íƒ€ì…ì´ ë‘˜ ì´ìƒì¼ ê²½ìš° ì˜ˆì œ

```java
public class ApplicationContextSameBeanFindTest {

    AnnotationConfigApplicationContext ac = new AnnotationConfigApplicationContext(SameBeanConfig.class);

    @Test
    @DisplayName("íƒ€ì…ìœ¼ë¡œ ì¡°íšŒì‹œ ê°™ì€ íƒ€ì…ì´ ë‘˜ ì´ìƒ ìˆìœ¼ë©´, ì¤‘ë³µ ì˜¤ë¥˜ ë°œìƒ -> NoUniqueBeanDefinitionException")
    void findBeanByTypeDuplicate() {
        assertThrows(NoUniqueBeanDefinitionException.class,
                () -> ac.getBean(MemberRepository.class));
    }

    @Test
    @DisplayName("íƒ€ì…ìœ¼ë¡œ ì¡°íšŒì‹œ ê°™ì€ íƒ€ì…ì´ ë‘˜ ì´ìƒì´ë©´, ë¹ˆ ì´ë¦„ì„ ì§€ì •í•œë‹¤.")
    void findBeanByName() {
        MemberRepository memberRepository = ac.getBean("memberRepository1", MemberRepository.class);
        assertThat(memberRepository).isInstanceOf(MemoryMemberRepository.class);
    }

    @Test
    @DisplayName("íŠ¹ì • íƒ€ì…ì„ ëª¨ë‘ ì¡°íšŒí•˜ê¸°")
    void findAllBeanByType() {
        Map<String, MemberRepository> beansOfType = ac.getBeansOfType(MemberRepository.class);
        for (String key : beansOfType.keySet()) {
            System.out.println("key = " + key + ", value = " + beansOfType.get(key));
        }
        System.out.println("beansOfType = " + beansOfType);
        assertThat(beansOfType.size()).isEqualTo(2);
    }

    @Configuration
    static class SameBeanConfig {
        @Bean
        public MemberRepository memberRepository1() {
            return new MemoryMemberRepository();
        }

        @Bean
        public MemberRepository memberRepository2() {
            return new MemoryMemberRepository();
        }
    }
}
```

## ìƒì†ê´€ê³„(ë¶€ëª¨ íƒ€ì…ìœ¼ë¡œ ì¡°íšŒí•  ê²½ìš°) ì˜ˆì œ

- ë¶€ëª¨ íƒ€ì…ìœ¼ë¡œ ì¡°íšŒí•˜ë©´ ìì‹íƒ€ì…ë„ ê°™ì´ ì¡°íšŒëœë‹¤.

![Untitled 4](https://user-images.githubusercontent.com/75190035/150499833-6549901a-72c2-4931-9116-9c61f2a79116.png)

```java
public class ApplicationContextExtendsFindTest {

    ApplicationContext ac = new AnnotationConfigApplicationContext(TestConfig.class);

    @Test
    @DisplayName("ë¶€ëª¨ íƒ€ì…ìœ¼ë¡œ ì¡°íšŒì‹œ ìì‹ì´ ë‘˜ ì´ìƒ ìˆìœ¼ë©´, ì¤‘ë³µ ì˜¤ë¥˜ ë°œìƒ")
    void findBeanByParentTypeDuplicate() {
        Assertions.assertThrows(NoUniqueBeanDefinitionException.class,
                () -> ac.getBean(DiscountPolicy.class));
    }

    @Test
    @DisplayName("ë¶€ëª¨ íƒ€ì…ìœ¼ë¡œ ì¡°íšŒì‹œ ìì‹ì´ ë‘˜ ì´ìƒ ìˆìœ¼ë©´, ë¹ˆ ì´ë¦„ ì§€ì •")
    void findBeanByParentTypeName() {
        DiscountPolicy rateDiscountPolicy = ac.getBean("rateDiscountPolicy", DiscountPolicy.class);
        assertThat(rateDiscountPolicy).isInstanceOf(RateDiscountPolicy.class);
    }

    @Test
    @DisplayName("íŠ¹ì • í•˜ìœ„ íƒ€ì…ìœ¼ë¡œ ì¡°íšŒ")
    void findBeanBySubType() {
        RateDiscountPolicy bean = ac.getBean(RateDiscountPolicy.class);
        assertThat(bean).isInstanceOf(RateDiscountPolicy.class);
    }

    @Test
    @DisplayName("ë¶€ëª¨ íƒ€ì…ìœ¼ë¡œ ëª¨ë‘ ì¡°íšŒí•˜ê¸°")
    void findAllBeanByParentType() {
        Map<String, DiscountPolicy> beansOfType = ac.getBeansOfType(DiscountPolicy.class);
        assertThat(beansOfType.size()).isEqualTo(2);
    }

    @Configuration
    static class TestConfig {
        @Bean
        public DiscountPolicy rateDiscountPolicy() {
            return new RateDiscountPolicy();
        }

        @Bean
        public DiscountPolicy fixDiscountPolicy() {
            return new FixDiscountPolicy();
        }
    }
}
```

## BeanFactory ì™€ ApplicationContext

![Untitled 5](https://user-images.githubusercontent.com/75190035/150499852-f5abb6a5-e81c-45e7-b759-e052a915fab1.png)

- **BeanFactory**
    - ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì˜ ìµœìƒìœ„ ì¸í„°í˜ì´ìŠ¤ë‹¤.
    - ìŠ¤í”„ë§ ë¹ˆì„ ê´€ë¦¬í•˜ê³  ì¡°íšŒí•˜ëŠ” ì—­í• ì„ ë‹´ë‹¹í•œë‹¤.
    - `getBean()` ì„ ì œê³µí•œë‹¤.
    - ìœ„ì—ì„œ ì‚¬ìš©í–ˆë˜ ëŒ€ë¶€ë¶„ì˜ ê¸°ëŠ¥ì€ `BeanFactory`ê°€ ì œê³µí•˜ëŠ” ê¸°ëŠ¥ì´ë‹¤.
- **ApplicationContext**
    - `BeanFactory` ê¸°ëŠ¥ì„ ëª¨ë‘ ìƒì†ë°›ì•„ì„œ ë” ë§ì€ ê¸°ëŠ¥ì„ ì œê³µí•œë‹¤.
    - ë©”ì‹œì§€ì†ŒìŠ¤ë¥¼ í™œìš©í•œ êµ­ì œí™” ê¸°ëŠ¥
        - ì˜ˆë¥¼ ë“¤ì–´ì„œ í•œêµ­ì—ì„œ ë“¤ì–´ì˜¤ë©´ í•œêµ­ì–´ë¡œ, ì˜ì–´ê¶Œì—ì„œ ë“¤ì–´ì˜¤ë©´ ì˜ì–´ë¡œ ì¶œë ¥
    - í™˜ê²½ë³€ìˆ˜
        - ë¡œì»¬, ê°œë°œ, ìš´ì˜ë“±ì„ êµ¬ë¶„í•´ì„œ ì²˜ë¦¬
    - ì• í”Œë¦¬ì¼€ì´ì…˜ ì´ë²¤íŠ¸
        - ì´ë²¤íŠ¸ë¥¼ ë°œí–‰í•˜ê³  êµ¬ë…í•˜ëŠ” ëª¨ë¸ì„ í¸ë¦¬í•˜ê²Œ ì§€ì›
    - í¸ë¦¬í•œ ë¦¬ì†ŒìŠ¤ ì¡°íšŒ
        - íŒŒì¼, í´ë˜ìŠ¤íŒ¨ìŠ¤, ì™¸ë¶€ ë“±ì—ì„œ ë¦¬ì†ŒìŠ¤ë¥¼ í¸ë¦¬í•˜ê²Œ ì¡°íšŒ

![Untitled 6](https://user-images.githubusercontent.com/75190035/150499884-49ea3d9b-c8e2-4a68-ab02-e470276bb25d.png)

<aside>
ğŸ’¡ ì¦‰, ApplicationContextëŠ” BeanFactoryì˜ ê¸°ëŠ¥ì„ ëª¨ë‘ ìƒì† ë°›ì„ë¿ë§Œ ì•„ë‹ˆë¼, ì¶”ê°€ì ì¸ ë¶€ê°€ ê¸°ëŠ¥ì„ ì œê³µí•œë‹¤.

</aside>

![Untitled 7](https://user-images.githubusercontent.com/75190035/150499914-b21d984a-37f5-470a-9b3f-e44e714dee22.png)
