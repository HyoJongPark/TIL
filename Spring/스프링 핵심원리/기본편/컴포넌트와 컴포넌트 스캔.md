# @Component, @ComponentScan

>[κΉ€μν•-μ¤ν”„λ§ ν•µμ‹¬μ›λ¦¬_κΈ°λ³ΈνΈ](https://www.inflearn.com/course/%EC%8A%A4%ED%94%84%EB%A7%81-%ED%95%B5%EC%8B%AC-%EC%9B%90%EB%A6%AC-%EA%B8%B0%EB%B3%B8%ED%8E%B8#)

## μ»΄ν¬λ„νΈ μ¤μΊ”κ³Ό μμ΅΄κ΄€κ³„ μλ™ μ£Όμ…

```java
@Configuration
@ComponentScan(
 excludeFilters = @Filter(type = FilterType.ANNOTATION, classes = Configuration.class))
public class AutoAppConfig {

}
```

- μ»΄ν¬λ„νΈ μ¤μΊ”μ„ μ‚¬μ©ν•λ ¤λ©΄ `@ComponentScan` μ• λ…Έν…μ΄μ…μ„ μ„¤μ • μ •λ³΄μ— λ¶™ν€μ¤
- κΈ°μ΅΄μ— AppConfigμ™€λ” λ‹¬λ¦¬ λ‚΄λ¶€μ— `@Bean`μΌλ΅ λ“±λ΅ν•λ” μ½”λ“ μ‘μ„±μ€ μ—†μ
- `@ComponentScan`μ„ μ‚¬μ©ν•λ©΄, `@Component` μ• λ…Έν…μ΄μ…μ΄ λ¶™μ€ ν΄λμ¤λ¥Ό μ¤ν”„λ§ λΉμΌλ΅ λ“±λ΅

> μ»΄ν¬λ„νΈ μ¤μΊ”μ„ μ‚¬μ©ν•λ©΄ `@Component` λΏλ§μ•„λ‹λΌ `@Configuration` μ²λΌ λ‚΄λ¶€μ— μ»΄ν¬λ„νΈ μ• λ…Έν…μ΄μ…μ„ κ°–κ³ μλ” μ• λ…Έν…μ΄μ… λ¨λ‘λ¥Ό μ¤μΊ”ν•λ‹¤.
λ§μ•½ μ›ν•μ§€ μ•λ” μ •λ³΄λ¥Ό μ μ™Έν•κ³  μ‹¶μ„ κ²½μ°λ” λ‹¤μ μ½”λ“λ¥Ό μ‚¬μ©ν•λ‹¤.
`@ComponentScan(excludeFilters = @Filter(type = FilterType.ANNOTATION, classes = Configuration.class))`                                                                                                                 μ„ μ½”λ“λ” νƒ€μ…-μ• λ…Έν…μ΄μ…, λ€μƒ-Configuration μ¦‰, @Configurationμ΄ λ¶™μ€ λ‹¤λ¥Έ λ€μƒμ€ μ μ™Έν•κ³  μ»΄ν¬λ„νΈμ¤μΊ”μ„ μν–‰ν•λ‹¤.
> 

```java
@Component
public class MemoryMemberRepository implements MemberRepository {}
```

```java
@Component
public class RateDiscountPolicy implements DiscountPolicy {}
```

```java
@Component
public class MemberServiceImpl implements MemberService {
 private final MemberRepository memberRepository;

 @Autowired
 public MemberServiceImpl(MemberRepository memberRepository) {
	 this.memberRepository = memberRepository;
 }
}
```

```java
@Component
public class OrderServiceImpl implements OrderService {
 private final MemberRepository memberRepository;
 private final DiscountPolicy discountPolicy;
 @Autowired
 public OrderServiceImpl(MemberRepository memberRepository, DiscountPolicy
discountPolicy) {
	 this.memberRepository = memberRepository;
	 this.discountPolicy = discountPolicy;
 }
}
```

- μ΄μ λ” μ„¤μ •μ •λ³΄μ—μ„ λΉ λ“±λ΅μ„ ν•λ” κ²ƒμ΄ μ•„λ‹ β€**κµ¬ν„ ν΄λμ¤**β€™μ— `@Component`λ¥Ό μ‚¬μ©ν•΄ λ“±λ΅
- μμ΅΄ κ΄€κ³„ μ£Όμ…μ΄ ν•„μ”ν• κ²½μ°λ” `@Autowired` λ¥Ό μ‚¬μ©ν•΄ μ£Όμ…λ°›κ³ , λ™μ‹μ— μ—¬λ¬ μμ΅΄κ΄€κ³„λ¥Ό μ£Όμ… λ°›λ” κ²ƒ λν• κ°€λ¥

### ν…μ¤νΈ

```java
@Test
void basicScan() {
	ApplicationContext ac = new AnnotationConfigApplicationContext(AutoAppConfig.class);
  MemberService memberService = ac.getBean(MemberService.class);
  assertThat(memberService).isInstanceOf(MemberService.class);
  }
```

- μ‚¬μ©λ²•μ€ μ „μ AppConfigμ™€ λ™μΌ

### μ»΄ν¬λ„νΈ μ¤μΊ”κ³Ό μμ΅΄κ΄€κ³„ μλ™μ£Όμ… κ³Όμ •

1. **@ComponentScan**
    - `@ComponentScan` μ€ `@Component` κ°€ λ¶™μ€ λ¨λ“  ν΄λμ¤λ¥Ό μ¤ν”„λ§ λΉμΌλ΅ λ“±λ΅
    - λΉ μ΄λ¦„μ€ ν΄λμ¤μ΄λ¦„μ— μ²«κΈ€μλ§μ„ μ†λ¬Έμλ΅ λ°”κΎΌ μ΄λ¦„μ„ μ‚¬μ©
        - MemberServiceImpl β†’ memberServiceImpl
    - μ§μ ‘ μ§€μ •ν•λ” κ²½μ°
        - `@Component("Rename")` μ„ μ‚¬μ©
        
![Untitled](https://user-images.githubusercontent.com/75190035/150501205-df0538c5-866f-4cb0-93a3-197944ea6643.png)

1. **@Autowired μμ΅΄κ΄€κ³„ μλ™ μ£Όμ…**
    - μƒμ„±μμ— `@Autowired`λ¥Ό μ‚¬μ©ν•λ©΄, μ¤ν”„λ§ μ»¨ν…μ΄λ„κ°€ ν•΄λ‹Ή μ¤ν”„λ§ λΉμ„ μ°Ύμ•„ μ£Όμ…
        - μ΄λ• μ΅°ν μ „λµμ€ κ°™μ€ β€νƒ€μ…β€μ„ κΈ°μ¤€μΌλ΅ ν•¨
            - `getBean(MemberRepository.class)`μ™€ κ°™μ€ μ›λ¦¬

![Untitled 1](https://user-images.githubusercontent.com/75190035/150501233-3a56abc5-82e7-4c1c-8296-cdb6590163c8.png)

---

## νƒμƒ‰ μ„μΉ, μ¤μΊ” λ€μƒ, ν•„ν„°

### **νƒμƒ‰μ„μΉ μ„¤μ •**

```java
@ComponentScan(basePackages = {"hello.core", "hello.core.spring"})
```

- `basePackages = β€rootβ€` λ¥Ό μ‚¬μ©ν•΄ μ¤μΊ”μ„ μ‹μ‘ν•  ν¨ν‚¤μ§€λ¥Ό μ„ νƒν•  μ μκ³ , κ·Έ ν¨ν‚¤μ§€μ ν•μ„ ν΄λ”λ¥Ό λ¨λ‘ νƒμƒ‰ν•λ‹¤.
    - Defaultλ” μ„¤μ • μ •λ³΄ ν΄λμ¤νμΌμ΄ μ„μΉν• ν¨ν‚¤μ§€κ°€ μ¤μΊ” μ‹μ‘ μ„μΉκ°€ λλ‹¤.
    - νƒμƒ‰ μ„μΉμ—λ” μ—¬λ¬κ°μ μ‹μ‘μ„μΉλ¥Ό μ§€μ •ν•  μ μλ‹¤.

<aside>
π“ κ¶μ¥ λ°©λ²•μ€ λ³„λ„μ μ„μΉμ§€μ •μ„ ν•μ§€ μ•κ³ , μ„¤μ • μ •λ³΄ ν΄λμ¤μ μ„μΉλ¥Ό ν”„λ΅μ νΈ μµμƒλ‹¨μ— μ„μΉμ‹ν‚¤λ” κ²ƒμ΄λ‹¤. (μ¤ν”„λ§λ¶€νΈλν• μ΄ λ°©λ²•μΌλ΅ ν”„λ΅μ νΈλ¥Ό μƒμ„±ν•λ‹¤.)

</aside>

### **μ¤μΊ” λ€μƒ**

- μ„μ—μ„λ„ μ–ΈκΈ‰ν–λ“―μ΄ μ»΄ν¬λ„νΈ μ¤μΊ”μ€ `@Component` λΏλ§ μ•„λ‹λΌ ν•΄λ‹Ή μ—λ…Έν…μ΄μ… λ‚΄λ¶€μ— `@Component` κ°€ ν¬ν•¨λ λ¨λ“  μΆ…λ¥μ μ• λ…Έν…μ΄μ…μ„ μ¤μΊ”ν•λ‹¤.
- μ»΄ν¬λ„νΈ μ¤μΊ”μ μ©λ„ λΏλ§ μ•„λ‹λΌ λ‹¤μ μ• λ…Έν…μ΄μ…μ΄ μμΌλ©΄ μ¤ν”„λ§μ€ λ¶€κ°€ κΈ°λ¥μ„ μν–‰ν•λ‹¤.
    - `@Controller` : μ¤ν”„λ§ MVC μ»¨νΈλ΅¤λ¬λ΅ μΈμ‹
    - `@Repository` : μ¤ν”„λ§ λ°μ΄ν„° μ ‘κ·Ό κ³„μΈµμΌλ΅ μΈμ‹ν•κ³ , λ°μ΄ν„° κ³„μΈµμ μμ™Έλ¥Ό μ¤ν”„λ§ μμ™Έλ΅ λ³€ν™ν•΄μ¤€λ‹¤.
    - `@Configuration` : μ•μ„ λ³΄μ•λ“―μ΄ μ¤ν”„λ§ μ„¤μ • μ •λ³΄λ΅ μΈμ‹ν•κ³ , μ¤ν”„λ§ λΉμ΄ μ‹±κΈ€ν†¤μ„ μ μ§€ν•λ„λ΅ μ¶”κ°€ μ²λ¦¬λ¥Ό ν•λ‹¤.
    - `@Service` : μ‚¬μ‹¤ `@Service` λ” νΉλ³„ν• μ²λ¦¬λ¥Ό ν•μ§€ μ•λ”λ‹¤. λ€μ‹  κ°λ°μλ“¤μ΄ ν•µμ‹¬ λΉ„μ¦λ‹μ¤ λ΅μ§μ΄ μ—¬κΈ°μ— μκ² κµ¬λ‚λΌκ³  λΉ„μ¦λ‹μ¤ κ³„μΈµμ„ μΈμ‹ν•λ”λ° λ„μ›€μ΄ λλ‹¤.

### ν•„ν„°

- `includeFilters`: μ»΄ν¬λ„νΈ μ¤μΊ” λ€μƒμ„ μ¶”κ°€λ΅ μ§€μ •ν•λ‹¤.
- `excludeFilters`: μ»΄ν¬λ„νΈ μ¤μΊ”μ—μ„ μ μ™Έν•  λ€μƒμ„ μ§€μ •ν•λ‹¤.

```java
@Configuration
@ComponentScan(
    includeFilters = @Filter(type = FilterType.ANNOTATION, classes = MyIncludeComponent.class),
    excludeFilters =  @Filter(type = FilterType.ANNOTATION, classes = MyExcludeComponent.class)
)
```

- ANNOTATION: κΈ°λ³Έκ°’, μ• λ…Έν…μ΄μ…μ„ μΈμ‹ν•΄μ„ λ™μ‘ν•λ‹¤.
    - ex) org.example.SomeAnnotation
- ASSIGNABLE_TYPE: μ§€μ •ν• νƒ€μ…κ³Ό μμ‹ νƒ€μ…μ„ μΈμ‹ν•΄μ„ λ™μ‘ν•λ‹¤.
    - ex) org.example.SomeClass
- ASPECTJ: AspectJ ν¨ν„΄ μ‚¬μ©
    - ex) org.example..*Service+*
- *REGEX: μ •κ· ν‘ν„μ‹*
    - *ex) org\.example\.Default.*
- CUSTOM: TypeFilter μ΄λΌλ” μΈν„°νμ΄μ¤λ¥Ό κµ¬ν„ν•΄μ„ μ²λ¦¬
    - ex) org.example.MyTypeFilter

---

## μ¤‘λ³µ λ“±λ΅κ³Ό μ¶©λ

- μ»΄ν¬λ„νΈ μ¤μΊ”μ—μ„λ” 2κ°€μ§€ κ²½μ°λ΅ μ¶©λμ΄ λ°μƒν•λ‹¤.
1. μλ™ λΉλ“±λ΅ vs μλ™ λΉλ“±λ΅
    - μ΄ κ²½μ°μ—λ” μ¤ν”„λ§μ€ β€ConflictingBeanDefinitionExceptionβ€™ μμ™Έλ¥Ό λ°μƒ μ‹ν‚¨λ‹¤.
2. μλ™ λΉλ“±λ΅ vs μλ™ λΉλ“±λ΅
    - μ΄ κ²½μ°μ—λ” μ¤ν”„λ§μ€ μλ™ λΉλ“±λ΅μ΄ μ°μ„ μ‹ λλ‹¤.(μλ™ λΉλ“±λ΅μ΄ μλ™ λΉμ„ μ¤λ²„λΌμ΄λ”©ν•¨)
        - μ¤ν”„λ§ λ¶€νΈμ—μ„λ” μ΄ κ²½μ°μ—λ„ μ¤λ¥κ°€ λ°μƒν•λ„λ΅ ν•¨.
