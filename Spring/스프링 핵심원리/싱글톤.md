# ì‹±ê¸€í†¤

>[ê¹€ì˜í•œ-ìŠ¤í”„ë§ í•µì‹¬ì›ë¦¬_ê¸°ë³¸í¸](https://www.inflearn.com/course/%EC%8A%A4%ED%94%84%EB%A7%81-%ED%95%B5%EC%8B%AC-%EC%9B%90%EB%A6%AC-%EA%B8%B0%EB%B3%B8%ED%8E%B8#)

```java
@Test
    @DisplayName("ìŠ¤í”„ë§ ì—†ëŠ” ìˆœìˆ˜í•œ DI ì»¨í…Œì´ë„ˆ")
    void pureContainer() {
        AppConfig appConfig = new AppConfig();

        MemberService memberService1 = appConfig.memberService();
        MemberService memberService2 = appConfig.memberService();

        System.out.println("memberService1 = " + memberService1);
        System.out.println("memberService2 = " + memberService2);

        Assertions.assertThat(memberService1).isNotSameAs(memberService2);
    }
```

![Untitled](https://user-images.githubusercontent.com/75190035/150500255-5a6e8fe0-26e1-4aa5-ad59-f5ba9dd66a4a.png)

- ìš°ë¦¬ê°€ ë§Œë“¤ì—ˆë˜ ìˆœìˆ˜í•œ DI ì»¨í…Œì´ë„ˆì¸ AppConfigëŠ” ìš”ì²­ì„ í•  ë•Œë§ˆë‹¤ ê°ì²´ë¥¼ ìƒì„±
    - ê³ ê° íŠ¸ë˜í”½ì´ ë§ì„ê²½ìš° ë©”ëª¨ë¦¬ ë‚­ë¹„ê°€ ì‹¬í•˜ë‹¤ â†’ ì‹±ê¸€í†¤ íŒ¨í„´ì„ í†µí•´ ê°ì²´ìƒì„±ì„ 1ê°œë§Œ í•˜ë„ë¡ ì„¤ê³„

---

## ì‹±ê¸€í†¤ íŒ¨í„´

- í´ë˜ìŠ¤ì˜ ì¸ìŠ¤í„´ìŠ¤ê°€ ë”± 1ê°œë§Œ ìƒì„±ë˜ëŠ” ê²ƒì„ â€œë³´ì¥â€í•˜ëŠ” ë””ìì¸ íŒ¨í„´
    - ê°™ì€ ê°ì²´ ì¸ìŠ¤í„´ìŠ¤ë¥¼ 2ê°œì´ìƒ ìƒì„±í•˜ì§€ ëª»í•˜ë„ë¡ í•´ì•¼í•¨

```java
public class SingletonService {

    private static final SingletonService instance = new SingletonService();

    public static SingletonService getInstance() {
        return instance;
    }

    //ì™¸ë¶€ì—ì„œ newë¡œ ê°ì²´ìƒì„±í•˜ëŠ” ê²ƒì„ ë§‰ìŒ
    private SingletonService() {
    }

    public void logic() {
        System.out.println("ì‹±ê¸€í†¤ ê°ì²´ ë¡œì§ í˜¸ì¶œ");
    }
}
```

```java
@Test
@DisplayName("ì‹±ê¸€í†¤ íŒ¨í„´ì„ ì ìš©í•œ ê°ì²´ ì‚¬ìš©")
void singletonService() {
    SingletonService singletonService1 = SingletonService.getInstance();
    SingletonService singletonService2 = SingletonService.getInstance();

    System.out.println("singletonService1 = " + singletonService1);
    System.out.println("singletonService2 = " + singletonService2);

    Assertions.assertThat(singletonService1).isSameAs(singletonService2);
}
```

![Untitled 1](https://user-images.githubusercontent.com/75190035/150500274-d3a36f1d-af80-406e-a27c-e3b177f6c6ed.png)

- ì‹±ê¸€í†¤ êµ¬í˜„ì½”ë“œì—ì„œ ìƒì„±ìë¥¼ privateë¡œ ì„¤ì •í•´ ì™¸ë¶€ì—ì„œ ìƒˆë¡œìš´ ê°ì²´ë¥¼ ìƒì„±í•˜ì§€ ëª»í•˜ë„ë¡ í•¨
    - ê²°ê³¼ë¡œ í…ŒìŠ¤íŠ¸ì½”ë“œì—ì„œë„ ê°™ì€ ì¸ìŠ¤í„´ìŠ¤ ê°ì²´ë¥¼ ë°˜í™˜
- ë¬¸ì œì 
    - ì‹±ê¸€í†¤ íŒ¨í„´ êµ¬í˜„ì— ì¶”ê°€ì ì¸ ì½”ë“œê°€ í•„ìš”í•¨
    - ì˜ì¡´ê´€ê³„ìƒ í´ë¼ì´ì–¸íŠ¸ê°€ êµ¬ì²´ í´ë˜ìŠ¤ì— ì˜ì¡´ â†’ DIP ìœ„ë°˜í•¨, OCP ìœ„ë°˜ ê°€ëŠ¥ì„±ì´ ë†’ì•„ì§
    - í…ŒìŠ¤íŠ¸í•˜ê¸° ì–´ë ¤ì›€
    - ë‚´ë¶€ ì†ì„±ì„ ë³€ê²½, ì´ˆê¸°í™” í•˜ê¸° í˜ë“¬
    - private ìƒì„±ìë¥¼ ì‚¬ìš©í•´ ìì‹ í´ë˜ìŠ¤ë¥¼ ë§Œë“¤ê¸° ì–´ë ¤ì›€ â†’ ìœ ì—°ì„±ì´ ë–¨ì–´ì§
    - ì•ˆí‹°íŒ¨í„´ìœ¼ë¡œë„ ë¶ˆë¦¼

---

## ì‹±ê¸€í†¤ ì»¨í…Œì´ë„ˆ

- ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆëŠ” ì‹±ê¸€í†¤ íŒ¨í„´ì˜ ë¬¸ì œì ì„ í•´ê²°í•˜ë©´ì„œ, ê°ì²´ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì‹±ê¸€í†¤ìœ¼ë¡œ ê´€ë¦¬í•œë‹¤.
- ì‹±ê¸€í†¤ íŒ¨í„´ì„ ì ìš©í•˜ì§€ ì•Šì•„ë„ ê°ì²´ë¥¼ ì‹±ê¸€í†¤ìœ¼ë¡œ ê´€ë¦¬í•¨
- ì‹±ê¸€í†¤ ì»¨í…Œì´ë„ˆ ì—­í• ì„ í•˜ë©° ì´ë ‡ê²Œ ì‹±ê¸€í†¤ ê°ì²´ë¥¼ ìƒì„±í•˜ê³  ê´€ë¦¬í•˜ëŠ” ê¸°ëŠ¥ì„ ì‹±ê¸€í†¤ ë ˆì§€ìŠ¤íŠ¸ë¦¬ë¼ê³  í•œë‹¤.

```java
@Test
    @DisplayName("ì‹±ê¸€í†¤ ì»¨í…Œì´ë„ˆì™€ ì‹±ê¸€í†¤")
    void springContainer() {
        ApplicationContext ac = new AnnotationConfigApplicationContext(AppConfig.class);

        MemberService memberService1 = ac.getBean("memberService", MemberService.class);
        MemberService memberService2 = ac.getBean("memberService", MemberService.class);

        System.out.println("memberService1 = " + memberService1);
        System.out.println("memberService2 = " + memberService2);

        Assertions.assertThat(memberService1).isSameAs(memberService2);
    }
```

![Untitled 2](https://user-images.githubusercontent.com/75190035/150500311-6deba6ea-4ebb-4036-aeb5-a36b3a2c0795.png)

<aside>
ğŸ“Œ ìŠ¤í”„ë§ì˜ ê¸°ë³¸ ë¹ˆ ë“±ë¡ ë°©ì‹ì€ ì‹±ê¸€í†¤ ì´ì§€ë§Œ, ì‹±ê¸€í†¤ ë°©ì‹ë§Œ ì§€ì›í•˜ëŠ” ê²ƒì€ ì•„ë‹ˆë‹¤. ìš”ì²­í•  ë•Œ ë§ˆë‹¤ ìƒˆë¡œìš´ ê°ì²´ë¥¼ ìƒì„±í•´ì„œ ë°˜í™˜í•˜ëŠ” ê¸°ëŠ¥ ë˜í•œ ì œê³µí•œë‹¤.

</aside>

- ì‹±ê¸€í†¤ ì ìš© ì „

![Untitled 3](https://user-images.githubusercontent.com/75190035/150500351-4228a544-5612-476c-9470-d245a84a2896.png)

- ì‹±ê¸€í†¤ ì ìš© í›„

![Untitled 4](https://user-images.githubusercontent.com/75190035/150500373-50a9be07-ffbf-4db2-85f1-bf3a037d59c1.png)

---

## ì‹±ê¸€í†¤ ë°©ì‹ì˜ ì£¼ì˜ì 

- ì‹±ê¸€í†¤ ë°©ì‹ì€ ì—¬ëŸ¬ í´ë¼ì´ì–¸íŠ¸ê°€ í•˜ë‚˜ì˜ ê°ì²´ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ê³µìœ í•˜ê¸° ë•Œë¬¸ì— ì‹±ê¸€í†¤ ê°ì²´ëŠ” ìƒíƒœë¥¼ ìœ ì§€(stateful)í•˜ê²Œ ì„¤ê³„í•˜ë©´ ì•ˆëœë‹¤. â†’ ë¬´ìƒíƒœ(stateless)ë¡œ ì„¤ê³„í•´ì•¼ í•œë‹¤.
    - íŠ¹ì • í´ë¼ì´ì–¸íŠ¸ì— ì˜ì¡´ì ì¸ í•„ë“œê°€ ìˆìœ¼ë©´ ì•ˆëœë‹¤.
    - íŠ¹ì • í´ë¼ì´ì–¸íŠ¸ê°€ ê°’ì„ ë³€ê²½í•  ìˆ˜ ìˆëŠ” í•„ë“œê°€ ìˆìœ¼ë©´ ì•ˆëœë‹¤.
    - ê°€ê¸‰ì  ì½ê¸°ë§Œ ê°€ëŠ¥í•´ì•¼ í•œë‹¤.
    - í•„ë“œ ëŒ€ì‹ ì— ìë°”ì—ì„œëŠ” ê³µìœ ë˜ì§€ ì•ŠëŠ” ì§€ì—­ë³€ìˆ˜, íŒŒë¼ë¯¸í„°, ThreadLocal ë“±ì„ ì‚¬ìš©í•´ì•¼ í•œë‹¤.

```java
public class StatefulService {

    private int price; //ìƒíƒœë¥¼ ìœ ì§€í•˜ëŠ” í•„ë“œ

    public void order(String name, int price) {
        System.out.println("name = " + name + ", price = " + price);
        this.price = price; //ë¬¸ì œ
    }

    public int getPrice() {
        return price;
    }
}
```

```java
@Test
void statefulServiceSingleton() {
    AnnotationConfigApplicationContext ac = new AnnotationConfigApplicationContext(TestConfig.class);
    StatefulService statefulService1 = ac.getBean(StatefulService.class);
    StatefulService statefulService2 = ac.getBean(StatefulService.class);

    //ThreadA: A ì‚¬ìš©ìê°€ 10000ì› ì£¼ë¬¸
    statefulService1.order("userA", 10000);
    //ThreadB: B ì‚¬ìš©ìê°€ 20000ì› ì£¼ë¬¸
    statefulService2.order("userB", 20000);
    //ThreadA: A ì‚¬ìš©ìê°€ ì£¼ë¬¸ ê¸ˆì•¡ ì¡°íšŒ
    int price = statefulService1.getPrice();
    System.out.println("price = " + price);

    Assertions.assertThat(statefulService1).isEqualTo(20000);
    }
```

- ìƒíƒœë¥¼ ìœ ì§€í•˜ë„ë¡ ì„¤ê³„ëœ priceë¡œ ì¸í•´ì„œ íŠ¹ì • í´ë¼ì´ì–¸íŠ¸ê°€ ê°€ê²©ì„ ë³€ê²½í•œë‹¤.

---

## @Configurationê³¼ ì‹±ê¸€í†¤

```java
@Test
void configurationTest() {
    ApplicationContext ac = new AnnotationConfigApplicationContext(AppConfig.class);

    MemberServiceImpl memberService = ac.getBean("memberService", MemberServiceImpl.class);
    OrderServiceImpl orderService = ac.getBean("orderService", OrderServiceImpl.class);
    MemberRepository memberRepository = ac.getBean("memberRepository", MemberRepository.class);

    MemberRepository memberRepository1 = memberService.getMemberRepository();
    MemberRepository memberRepository2 = orderService.getMemberRepository();

    System.out.println("MemberServiceImpl -> memberRepository1 = " + memberRepository1);
    System.out.println("OrderServiceImpl -> memberRepository2 = " + memberRepository2);
    System.out.println("memberRepository = " + memberRepository);

    Assertions.assertThat(memberRepository1).isSameAs(memberRepository2);
    Assertions.assertThat(memberRepository1).isEqualTo(memberRepository);
    }
```

![Untitled 5](https://user-images.githubusercontent.com/75190035/150500400-7a036c9e-80f3-4a11-be05-3ce7a2c25530.png)

![Untitled 6](https://user-images.githubusercontent.com/75190035/150500412-dbb27293-b232-466b-a90d-77c7e645a31a.png)

<aside>
ğŸ“Œ ìš°ë¦¬ê°€ ë§Œë“¤ì—ˆë˜ AppConfigë¥¼ ë³´ë©´ memberRepositoryëŠ” 3ë²ˆ í˜¸ì¶œë˜ì–´ ë§ˆì¹˜ 3ë²ˆì˜ ê°ì²´ ìƒì„±ì„ í•˜ëŠ” ê²ƒ ì²˜ëŸ¼ ë³´ì¸ë‹¤. í•˜ì§€ë§Œ ê²°ê³¼ë¥¼ ë³´ë©´ í…ŒìŠ¤íŠ¸ ì½”ë“œì—ì„œ 2ê°œì˜ memberRepositoryëŠ” ì„œë¡œ ê°™ì€ ê°ì²´ì„ì„ ì•Œ ìˆ˜ ìˆê³ , í„°ë¯¸ë„ ì¶œë ¥ ê²°ê³¼ì—ì„œë„ memberRepositoryëŠ” 1ë²ˆì˜ í˜¸ì¶œ ì´í›„ í˜¸ì¶œë˜ì§€ ì•ŠëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤. â†’ ì¦‰, ì‹±ê¸€í†¤ì„ ë³´ì¥ë°›ì•˜ë‹¤.

</aside>

---

## @Configurationê³¼ ë°”ì´íŠ¸ì½”ë“œ ì¡°ì‘

- ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆëŠ” ì‹±ê¸€í†¤ ë ˆì§€ìŠ¤íŠ¸ë¦¬ë¡œ ìŠ¤í”„ë§ ë¹ˆì´ ì‹±ê¸€í†¤ì´ ë˜ë„ë¡ ë³´ì¥í•´ ì£¼ì–´ì•¼ í•œë‹¤.
    - ìœ„ í…ŒìŠ¤íŠ¸ ê²°ê³¼ì²˜ëŸ¼ ì‹±ê¸€í†¤ì„ ë³´ì¥í•˜ê¸°ìœ„í•´ ìŠ¤í”„ë§ì€ í´ë˜ìŠ¤ì˜ ë°”ì´íŠ¸ì½”ë“œë¥¼ ì¡°ì‘í•˜ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•œë‹¤.

![Untitled 7](https://user-images.githubusercontent.com/75190035/150500430-b9233606-4cb1-4b66-a55e-897f600adf42.png)

![Untitled 8](https://user-images.githubusercontent.com/75190035/150500441-6223db71-110c-4164-8dc5-62bcf26d3e41.png)

- ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì— ë“±ë¡ëœ AppConfigì˜ í´ë˜ìŠ¤ íƒ€ì…ì´ë‹¤. í´ë˜ìŠ¤ë©´ ë’¤ì— xxxCGLIBê°™ì€ ì•Œìˆ˜ì—†ëŠ” ì½”ë“œë“¤ì´ ë§ë¶™í˜€ì ¸ìˆë‹¤.
    - ì´ê²ƒì€ ë‚´ê°€ë§Œë“  í´ë˜ìŠ¤ê°€ ì•„ë‹Œ ìŠ¤í”„ë§ì´ CGLIBì´ë¼ëŠ” ë°”ì´íŠ¸ì½”ë“œ ì¡°ì‘ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•´ì„œ AppConfig í´ë˜ìŠ¤ë¥¼ ìƒì†ë°›ì€ ì„ì˜ì˜ ë‹¤ë¥¸ í´ë˜ìŠ¤ë¥¼ ë§Œë“¤ê³ , ì´ê²ƒì´ ìŠ¤í”„ë§ ë¹ˆìœ¼ë¡œ ë“±ë¡ëœ ê²ƒì´ë‹¤.
    - ì´ ì„ì˜ì˜ ë‹¤ë¥¸ í´ë˜ìŠ¤ê°€ ì‹±ê¸€í†¤ì„ ë³´ì¥ í•´ì¤€ë‹¤.
- ì˜ˆìƒ ì½”ë“œ

```java
@Bean
public MemberRepository memberRepository() {

  if (memoryMemberRepositoryê°€ ì´ë¯¸ ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì— ë“±ë¡ë˜ì–´ ìˆìœ¼ë©´?) {
    return ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì—ì„œ ì°¾ì•„ì„œ ë°˜í™˜;
    } 
  else { 
  //ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì— ì—†ìœ¼ë©´ ê¸°ì¡´ ë¡œì§ì„ í˜¸ì¶œí•´ì„œ MemoryMemberRepositoryë¥¼ ìƒì„±í•˜ê³  ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì— ë“±ë¡
    return ë°˜í™˜
    }
}
```

- `@Bean`ì´ ë¶™ì€ ë©”ì„œë“œë§ˆë‹¤ ì´ë¯¸ ìŠ¤í”„ë§ ë¹ˆì´ ì¡´ì¬í•˜ë©´ ì¡´ì¬í•˜ëŠ” ë¹ˆì„ ë°˜í™˜í•˜ê³ , ìŠ¤í”„ë§ ë¹ˆì´ ì—†ìœ¼ë©´, ìƒì„±í•´ì„œ ìŠ¤í”„ë§ ë¹ˆìœ¼ë¡œ ë“±ë¡í•˜ê³  ë°˜í™˜í•˜ëŠ” ì½”ë“œê°€ ë™ì ìœ¼ë¡œ ë§Œë“¤ì–´ì§„ë‹¤
    
    â†’ ë•ë¶„ì— ì‹±ê¸€í†¤ì„ ë³´ì¥ë°›ëŠ”ë‹¤.
    

> `AppConfig@CGLIB`ëŠ” AppConfigì˜ ìì‹ íƒ€ì…ì´ë¯€ë¡œ, AppConfig íƒ€ì…ìœ¼ë¡œ ì¡°íšŒ í•  ìˆ˜ ìˆë‹¤.
> 

- `@Configuration`ì„ ì‚¬ìš©í•˜ì§€ ì•Šìœ¼ë©´?
    - ë”ì´ìƒ CGLIBê¸°ìˆ ì„ í†µí•œ ì‹±ê¸€í†¤ì„ ë³´ì¥ë°›ì§€ ëª»í•œë‹¤.
    - EX) ê°ì²´ë¥¼ ìŠ¤í”„ë§ ë¹ˆì— ë“±ë¡í•  ë•Œë§ˆë‹¤ ë‹¤ë¥¸ ê°ì²´ê°€ ìƒì„±ë˜ëŠ” ë“±
